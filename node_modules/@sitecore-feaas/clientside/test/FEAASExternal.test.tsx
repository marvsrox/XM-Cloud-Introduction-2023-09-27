import { beforeEach, describe, expect, it } from 'vitest'
import React from 'react'
import * as Clientside from '../src/ui/react.js'
import FEAASExternal from "../src/ui/FEAASExternal.js";

describe('External', () => {
  function Hello(props: { firstName: string; telephone: string }) {
    return React.createElement('div', {}, `Hello my name is ${props.firstName} and my tel is ${props.telephone}`)
  }
  function Hello2(props: { firstName: string; address: string }) {
    return React.createElement('div', {}, `Hello my name is ${props.firstName} and my address is ${props.address}`)
  }
  it('can register and render component', async () => {
    Clientside.External.registerComponent(Hello, {}, 'MyTestComponent')
    document.body.innerHTML =
      '<feaas-external id="external-component" class="-component" data-attributes-keys="first-name,telephone" first-name="Chuck" telephone="45657890875643" data-attributes="{&quot;first-name&quot;:&quot;Chuck&quot;,&quot;telephone&quot;:&quot;45657890875643&quot;}" data-external-id="MyTestComponent" contenteditable="false"></feaas-external>'
    const component = document.getElementById('external-component') as FEAASExternal
    await expect(component.whenRendered).resolves.toEqual(component)
    expect(component.innerHTML).toEqual('<div>Hello my name is Chuck and my tel is 45657890875643</div>')
  })
  it('can take functional component name as id', async () => {
    Clientside.External.registerComponent(Hello)
    document.body.innerHTML =
      '<feaas-external id="external-component" class="-component" data-attributes-keys="first-name,telephone" first-name="Chuck" telephone="45657890875643" data-attributes="{&quot;first-name&quot;:&quot;Chuck&quot;,&quot;telephone&quot;:&quot;45657890875643&quot;}" data-external-id="Hello" contenteditable="false"></feaas-external>'
    const component = document.getElementById('external-component') as FEAASExternal
    await expect(component.whenRendered).resolves.toEqual(component)
    expect(component.innerHTML).toEqual('<div>Hello my name is Chuck and my tel is 45657890875643</div>')
  })
  it('should return empty if component is not registered', async () => {
    document.body.innerHTML =
      '<feaas-external id="external-component" class="-component" data-external-id="NotRegisteredComponent" contenteditable="false"></feaas-external>'
    const component = document.getElementById('external-component') as FEAASExternal
    await expect(component.whenRendered).resolves.toEqual(component)
    expect(component.innerHTML).toEqual('')
  })
  it('can register and render multiple components', async () => {
    Clientside.External.registerComponent(Hello, {}, 'MyTestComponent1')
    Clientside.External.registerComponent(Hello2, {}, 'MyTestComponent2')
    document.body.innerHTML =
      '<feaas-external id="external-component1" class="-component" data-attributes-keys="first-name,telephone" first-name="Chuck" telephone="45657890875643" data-attributes="{&quot;first-name&quot;:&quot;Chuck&quot;,&quot;telephone&quot;:&quot;45657890875643&quot;}" data-external-id="MyTestComponent1" contenteditable="false"></feaas-external>' +
      '<feaas-external id="external-component2" class="-component" data-attributes-keys="first-name,address" first-name="George" address="Test street 12" data-attributes="{&quot;first-name&quot;:&quot;George&quot;,&quot;address&quot;:&quot;Test street 12&quot;}" data-external-id="MyTestComponent2" contenteditable="false"></feaas-external>'
    const component1 = document.getElementById('external-component1') as FEAASExternal
    await expect(component1.whenRendered).resolves.toEqual(component1)
    expect(component1.innerHTML).toEqual('<div>Hello my name is Chuck and my tel is 45657890875643</div>')
    const component2 = document.getElementById('external-component2') as FEAASExternal
    await expect(component2.whenRendered).resolves.toEqual(component2)
    expect(component2.innerHTML).toEqual('<div>Hello my name is George and my address is Test street 12</div>')
  })
})
